{
  "name": "1. Atendente Motok√£o [v2]",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.body.message_type }}",
              "rightValue": "incoming",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "149f8496-42a2-44d8-85ce-27f4f8dd76d7"
            },
            {
              "leftValue": "={{ $json.body.conversation?.labels }}",
              "rightValue": "agente-off",
              "operator": {
                "type": "array",
                "operation": "notContains",
                "rightType": "any"
              },
              "id": "a36d3a6e-779d-46e1-a533-fe4ffe772bce"
            },
            {
              "id": "f215f904-dbfd-49e9-986e-4faf0e981d64",
              "leftValue": "={{ $json.body.conversation?.labels }}",
              "rightValue": "mecanico",
              "operator": {
                "type": "array",
                "operation": "notContains",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "440b19fa-3bb4-457f-b76f-5c39ba045b2b",
      "name": "üîç Filtrar Mensagens",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -2896,
        256
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $json.body.conversation.id }}_{{ $json.body.id }}",
        "options": {}
      },
      "id": "bf697bc2-8c29-4b16-8619-410a3d5598b3",
      "name": "‚ö° Cache Redis Check",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2208,
        224
      ],
      "credentials": {
        "redis": {
          "id": "LEzG1SL5E566nY65",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.value }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isEmpty"
              },
              "id": "78adc0f8-c25a-4b59-aa85-67b3492f1874"
            },
            {
              "id": "f0158bac-2764-4160-8332-7e59c3516339",
              "leftValue": "={{ $('‚ö° Cache Redis Check').item.json.value }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "881a2586-53f0-4e3a-a559-6caa77a68fe8",
      "name": "üÜï Nova Mensagem?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1984,
        224
      ]
    },
    {
      "parameters": {
        "operation": "set",
        "key": "={{ $json.body.conversation.id }}_{{ $json.body.id }}",
        "value": "processed",
        "expire": true,
        "ttl": 3600
      },
      "id": "020a1d7d-87bb-4b30-a917-71358b18fab8",
      "name": "‚úÖ Marcar Processado",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1760,
        208
      ],
      "credentials": {
        "redis": {
          "id": "LEzG1SL5E566nY65",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "motokao_message_queue",
          "mode": "list"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "id_mensagem",
              "value": "={{ $json.id_mensagem }}"
            },
            {
              "column": "id_conta",
              "value": "={{ $json.id_conta }}"
            },
            {
              "column": "id_conversa",
              "value": "={{ $json.id_conversa }}"
            },
            {
              "column": "telefone",
              "value": "={{ $json.telefone }}"
            },
            {
              "column": "nome_cliente",
              "value": "={{ $json.nome_cliente }}"
            },
            {
              "column": "mensagem",
              "value": "={{ $json.mensagem }}"
            },
            {
              "column": "mensagem_de_audio",
              "value": "={{ $json.mensagem_de_audio }}"
            },
            {
              "column": "audio_url",
              "value": "={{ $json.audio_url || null }}"
            },
            {
              "column": "timestamp",
              "value": "={{ $json.timestamp }}"
            },
            {
              "column": "etiquetas",
              "value": "={{ $json.etiquetas }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b3747e7f-a21a-466d-9a29-315a1b5048ed",
      "name": "üì• Enfileirar Mensagem",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        -992,
        48
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase Motok√£o"
        }
      }
    },
    {
      "parameters": {
        "amount": 10,
        "unit": "seconds"
      },
      "id": "f237dfb2-28b5-4182-b1da-203f02f6ecf9",
      "name": "‚è≥ Aguardar Fila",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        -800,
        48
      ],
      "webhookId": "74568c9b-5102-48de-b494-be330a24a069"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "motokao_message_queue",
          "mode": "list"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "telefone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "sort": {
          "values": [
            {
              "column": "timestamp"
            }
          ]
        },
        "options": {}
      },
      "id": "6ac10f71-7cab-44ea-b33b-e8c13b606c71",
      "name": "üìã Buscar Fila",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        -608,
        48
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase Motok√£o"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "motokao_message_queue",
          "mode": "list"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "telefone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "48ae88da-666e-476b-8221-df6043f97180",
      "name": "üóëÔ∏è Limpar Fila",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        -224,
        48
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase Motok√£o"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot.motokaovirtual.com.br/api/v1/accounts/{{ $('üìã Extrair Informa√ß√µes').item.json.id_conta }}/conversations/{{ $('üìã Extrair Informa√ß√µes').item.json.id_conversa }}/toggle_typing_status",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "typing_status",
              "value": "on"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "text"
            }
          }
        }
      },
      "id": "2de7f08f-447f-4550-be5a-6ec1615f0311",
      "name": "‚å®Ô∏è Status Digitando",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        96,
        208
      ],
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "mensagem_final",
              "stringValue": "={{ \n(() => {\n  const t = (v) => (v ?? '').toString().trim();\n\n  // Sempre existe\n  const info = $('üìã Extrair Informa√ß√µes').first().json || {};\n  const isAudio = !!info.mensagem_de_audio; // vem do Extrair Info\n\n  // Se N√ÉO for √°udio, tenta pegar s√≥ a √öLTIMA mensagem da fila\n  if (!isAudio) {\n    try {\n      const fila = $('üéØ Verificar Posi√ß√£o na Fila').all();\n      if (fila.length) {\n        const ult = fila[fila.length - 1];\n        const msg = t(ult.json?.mensagem);\n        if (msg) return msg;\n      }\n    } catch (e) { /* n√≥ n√£o executou? tudo bem */ }\n  }\n\n  // Se for √°udio (ou texto da fila n√£o veio), tenta a transcri√ß√£o\n  try {\n    const tx = $('Transcrever audio').first(); // nome exato do n√≥\n    const txText = t(tx?.json?.text);\n    if (txText) return txText;\n  } catch (e) { /* n√≥ n√£o executou? segue o baile */ }\n\n  // Fallback: conte√∫do bruto\n  return t(info.mensagem);\n})()\n}}\n"
            },
            {}
          ]
        },
        "options": {}
      },
      "id": "d525663d-8162-40f9-9891-2b8d80035eef",
      "name": "üìù Preparar Mensagem",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        320,
        208
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('üìã Extrair Informa√ß√µes').item.json.telefone }}",
        "tableName": "motokao_chat_memory"
      },
      "id": "4b8df94a-26ae-4cc3-9908-9022db1c5091",
      "name": "üß† Mem√≥ria de Conversa",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1,
      "position": [
        432,
        448
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase Motok√£o"
        }
      }
    },
    {
      "parameters": {
        "description": "=**Ferramenta de An√°lise e Estrat√©gia T√©cnica.** Use esta ferramenta como seu passo ZERO para qualquer solicita√ß√£o que n√£o seja trivial. Sua fun√ß√£o √© modelar seu racioc√≠nio de especialista.\n\n**CEN√ÅRIOS DE USO OBRIGAT√ìRIO:**\n- **Consultas Multi-Produto:** Cliente pede mais de um item.\n- **An√°lise de Compatibilidade Cruzada:** Pe√ßa vs. Moto, Pe√ßa vs. Pe√ßa.\n- **Dedu√ß√£o de Inten√ß√£o:** Quando o pedido √© um uso (ex: \"pneu pra fazer trilha\") e n√£o um produto espec√≠fico.\n- **Planejamento de Busca:** Antes de qualquer busca, para definir os termos exatos a serem usados.\n\n**PROTOCOLO DE SA√çDA OBRIGAT√ìRIO:**\nSua sa√≠da DEVE seguir estritamente o seguinte formato de Markdown:\n\n**An√°lise:** [Aqui voc√™ descreve sua interpreta√ß√£o da necessidade real e completa do cliente.]\n**Plano de A√ß√£o:**\n1.  **Passo 1:** [Descreva a primeira a√ß√£o que voc√™ vai tomar, ex: 'Usar a ferramenta X para buscar Y'.]\n2.  **Passo 2:** [Descreva a segunda a√ß√£o, se houver.]\n3.  **...**\n**Valida√ß√£o:** [Descreva o que voc√™ precisa confirmar ou a hip√≥tese que est√° testando com seu plano.]\n\n**Exemplo:**\n**An√°lise:** O cliente precisa do kit completo de transmiss√£o (coroa, corrente, pinh√£o) para a moto Honda Bros 160, ano 2020.\n**Plano de A√ß√£o:**\n1.  **Passo 1:** Usar `buscar_produtos_motokao` com o termo \"coroa Bros 160 2020\".\n2.  **Passo 2:** Usar `buscar_produtos_motokao` com o termo \"corrente Bros 160 2020\".\n3.  **Passo 3:** Usar `buscar_produtos_motokao` com o termo \"pinh√£o Bros 160 2020\".\n4.  **Passo 4:** Consolidar os resultados e apresentar ao cliente.\n**Valida√ß√£o:** Preciso confirmar a disponibilidade e o pre√ßo de cada um dos tr√™s componentes para o modelo e ano exatos."
      },
      "id": "a3cc2579-4a69-4923-bffe-0edb51dfda02",
      "name": "ü§î Ferramenta de Racioc√≠nio",
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        1200,
        448
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot.motokaovirtual.com.br/api/v1/accounts/{{ $('üìã Extrair Informa√ß√µes').item.json.id_conta }}/conversations/{{ $('üìã Extrair Informa√ß√µes').item.json.id_conversa }}/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "content",
              "value": "={{ $json.content }}"
            },
            {
              "name": "message_type",
              "value": "outgoing"
            }
          ]
        },
        "options": {}
      },
      "id": "cf975af3-e42f-48f3-9d64-4e2c43920d8b",
      "name": "üì§ Enviar Mensagem",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        1200,
        208
      ],
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "‚úÖ Mensagem Motok√£o processada com sucesso!",
        "options": {}
      },
      "id": "75bdd241-54bf-4bbd-8192-a4c27bce9c4c",
      "name": "‚úÖ Resposta Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1440,
        208
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "003c4b22-55e7-4897-a3e0-c8e1a3ad5540",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3136,
        256
      ],
      "id": "7e097cdb-556e-42a5-85a6-b1b8b0da9201",
      "name": "üéØ Webhook Chatwoot",
      "webhookId": "003c4b22-55e7-4897-a3e0-c8e1a3ad5540"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem_final }}",
        "options": {
          "systemMessage": "=HOJE √â: {{ $now.format('FFFF') }}\n\n# AGENTE DE ATENDIMENTO **Motok√£o**\n**Fun√ß√£o:** Assistente virtual para atendimento e suporte t√©cnico  \n**Objetivo Prim√°rio:**\n- Responder perguntas sobre produtos e servi√ßos. Apenas assuntos relacionados √† empresa.\n- Consultar bancos de dados em tempo real.\n- Escalar casos complexos para humanos.\n**Tom:** Amig√°vel, profissional, emp√°tico e direto, sem enrola√ß√µes. Evitar jarg√µes t√©cnicos nas explica√ß√µes; manter t√≠tulos t√©cnicos conforme o cat√°logo.\n\n## üèÅ CONTEXTO OPERACIONAL\n- **Especializa√ß√£o / Escopo:**\n  - Manuten√ß√£o **preventiva** (antes da falha) e **corretiva** (p√≥s-falha).\n  - **Especializa√ß√£o:** atendemos motos **100‚Äì400cc**, qualquer moto fora dessa faixa precisamos consultar com o mecanico.   \n  - **Hor√°rio de funcionamento:** Segunda a sexta das **7:30h √†s 18h**; **s√°bado e domingo n√£o abrimos**.\n\n- **Limites de Atua√ß√£o:**  \n  - ‚ùå N√£o dar instru√ß√µes mec√¢nicas (o assistente entende o tema, mas n√£o fornece passo a passo t√©cnico).  \n  - ‚ùå N√£o diagnosticar problemas sem dados suficientes ‚Äî pe√ßa para trazer a moto para analisarmos melhor.  \n  - ‚ùå N√£o √© necess√°rio revelar o nosso SKU para o cliente.  \n  - ‚ùå N√£o √© necess√°rio informar a quantidade de estoque dispon√≠vel.  \n  - ‚ùå N√£o insira muitos assuntos na conversa; foque apenas no que o cliente precisa, um de cada vez.  \n  - ‚ùå N√£o d√™ valores de m√£o de obra; diga que vai verificar com o respons√°vel e transfira para um humano.\n\n### üö¶ Fluxo de Atendimento ‚Äî Chain of Thought\n\n1) Sauda√ß√£o\n- \"Ol√°! Sou o assistente do Motok√£o üëã Como posso te ajudar?\"\n\n2) Quando o cliente pedir pre√ßo\n- Pergunte: \"Voc√™ precisa s√≥ da pe√ßa ou j√° com instala√ß√£o?\"\n- Capture dados essenciais (se ainda n√£o tiver): \"Qual o modelo da moto e o ano?\"\n- Reforce com sutileza: \"A instala√ß√£o aqui no Motok√£o garante qualidade e garantia do servi√ßo e da pe√ßa.\"\n\n3) Se for **s√≥ a pe√ßa**\n- [Consultar banco de dados \"produtos\" e confirmar modelo/ano exatos]\n- Se encontrado: \"Encontrei **[PE√áA]** para **[MOTO/ANO]** por **R$ [PRE√áO]**.\"\n- Complementos √∫teis:\n  - (Se houver varia√ß√µes): \"Temos essas op√ß√µes: [VARIA√á√ïES QUE FIZEREM SENTIDO, N√ÉO FALE DE PE√áAS ALEAT√ìRIAS].\"\n\n4) Se for **pe√ßa + instala√ß√£o**\n- \"Para te passar o valor instalado preciso confirmar a m√£o de obra com a oficina. Vou te transferir agora para um atendente.\" [Transferir para humano]\n\n5) Encerramento\n- \"Posso te ajudar em mais alguma coisa?\"\n\n#### Regras r√°pidas (evita erro)\n- N√£o invente pre√ßo/estoque. Se houver d√∫vida, pe√ßa confirma√ß√£o do modelo/ano e c√≥digo/SKU.\n- Sempre que poss√≠vel, envie o link do an√∫ncio (Mercado Livre) ou c√≥digo interno para o cliente conferir.\n- Se o cliente estiver indeciso, ofere√ßa reservar por tempo limitado (conforme pol√≠tica da loja) ou avisar quando repor.\n\n\n### Pol√≠ticas de Escalonamento  \n- Reclama√ß√£o de servi√ßo feito por n√≥s.  \n- Falha na consulta (tente novamente e escale na 2¬™ falha).  \n- Pedido de or√ßamento complexo, com muitas pe√ßas ou envolvendo m√£o de obra.\n\n## ‚öôÔ∏è FERRAMENTAS OPERACIONAIS\n### 1. `faq` (Banco de Dados Supabase)\n- **Uso:** Consultar para perguntas gerais.\n\n### 2. `produtos` (Banco de Dados Supabase)\n- **Uso:** Acione ao detectar interesse em **saber mais sobre uma pe√ßa** (detalhes, compatibilidade, pre√ßo).\n\n## MODO DE USAR AS FERRAMENTAS\n### 1. `faq`  \nUse para perguntas gerais. Sempre que algo n√£o estiver no system prompt ou no hist√≥rico da conversa, use essa ferramenta para confirmar detalhes sobre a d√∫vida do cliente; caso n√£o encontre, **fa√ßa a transfer√™ncia para um humano**.\n\n### 2. `produtos` ‚Äî Fluxo de uso da ferramenta\n1. **Entender o pedido do cliente**  \n   - Identifique a pe√ßa solicitada.  \n   - Liste poss√≠veis **sin√¥nimos, abrevia√ß√µes e descri√ß√µes equivalentes**.\n2. **Analisar a motocicleta**  \n   - Confirme **modelo** e **ano** exatos informados pelo cliente.  \n   - Caso o ano n√£o seja informado, **pergunte antes de prosseguir**.\n3. **Pesquisar no cat√°logo**  \n   - Utilize **sin√¥nimos + modelo + ano** como filtros.  \n   - Priorize correspond√™ncias **exatas de ano**; se n√£o houver, verifique **anos adjacentes** (ex.: 2022/2024 quando o cliente busca 2023).\n4. **Quando n√£o houver o ano exato**  \n   > ‚ÄúEncontrei a pe√ßa **X** para sua moto. Mas preciso confirmar com o mec√¢nico se ela serve no **[ANO]** da sua moto.‚Äù\n5. **Padr√£o de t√≠tulo de produto**  \n   **NOME DA PE√áA [√†s vezes com abrevia√ß√£o] + MOTO DE APLICA√á√ÉO (ANO) + OUTRAS MOTOS COMPAT√çVEIS + MARCA [√†s vezes indispon√≠vel]**  \n   **Exemplo:** `KIT RELA√á√ÉO CG160 16...22/BROS160 18...22 DID`  \n   *Lembrete:* a pe√ßa necess√°ria pode estar listada como compat√≠vel com outros modelos (ex.: pedido para Bros 160 pode aparecer na descri√ß√£o da CG 160).\n\n## Pol√≠ticas da empresa\n- **Entregas:** N√£o fazemos **entregas pela loja f√≠sica dentro da cidade**. **Se o cliente morar em outra cidade podemos fazer o envio atrav√©s de transportadora ou Mercado Livre**.  \n- **Atendimento:** N√£o fazemos agendamento; trabalhamos por **ordem de chegada**.  \n- **Instala√ß√£o de pe√ßas:** N√£o instalamos pe√ßas que **n√£o** foram compradas com a gente.\n- **Escopo de servi√ßos:** N√£o realizamos servi√ßos em motos de alta cilindrada (**acima de 400cc**) nem em motos importadas de dif√≠cil acesso a pe√ßas.\n- **Pagamentos (balc√£o presencial):**\n  - Parcelamos compras no **cart√£o em at√© 3x sem juros** (balc√£o).\n  - **Desconto:** 5% no **dinheiro** √† vista ou 3% no **Pix** (somente para pagamentos no balc√£o).\n\n### Pol√≠tica de Pe√ßas\n**Posi√ß√£o oficial:** Trabalhamos **exclusivamente com pe√ßas paralelas  de alta qualidade**. S√£o op√ß√µes de **custo consideravelmente menor** e **qualidade muito semelhante** √†s originais. Selecionamos **marcas confi√°veis** para evitar dor de cabe√ßa para o cliente e empresa.\n\n**O que o agente deve fazer**\n- ‚úÖ Dizer que s√≥ oferecemos **paralelas de alta qualidade**.\n- ‚úÖ Destacar **bom custo-benef√≠cio** e **qualidade equivalente**.\n- ‚úÖ Refor√ßar que **somos criteriosos na escolha das marcas**.\n\n**O que o agente n√£o deve fazer**\n- ‚ùå **N√£o** oferecer pe√ßas originais nem sugerir que conseguimos sob demanda.\n- ‚ùå **N√£o** prometer que a pe√ßa √© ‚Äúid√™ntica √† original‚Äù; prefira ‚Äúqualidade **muito semelhante**/equivalente‚Äù.\n- ‚ùå **N√£o** citar marcas espec√≠ficas se n√£o estiverem no contexto/dados.\n\n**Frases modelo (use e adapte)**\n- ‚ÄúTrabalhamos **somente com pe√ßas paralelas de alta qualidade**, com **custo bem mais baixo** e **qualidade muito semelhante** √† original.‚Äù\n- ‚ÄúSelecionamos **apenas marcas confi√°veis** para garantir durabilidade e evitar problemas futuros para o cliente e empresa.‚Äù\n- ‚ÄúN√£o oferecemos pe√ßa original; nossa **linha √© paralela premium**, com **excelente custo-benef√≠cio**.‚Äù\n\n**Se o cliente pedir pe√ßa original**\n- Responder: ‚ÄúNo momento trabalhamos **exclusivamente com pe√ßas paralelas de alta qualidade**. Posso verificar a op√ß√£o equivalente para o seu modelo?‚Äù\n\n- **Garantia:** segue a legisla√ß√£o vigente e cobre apenas **defeitos de fabrica√ß√£o**, n√£o por mal uso.\n- **Pol√≠tica de vendas e trocas:**\n  - N√£o vendemos **pe√ßas usadas**.\n  - N√£o realizamos **devolu√ß√£o de pe√ßas** ap√≥s instala√ß√£o.\n  - **Troca** de produtos deve ser transferido para um humano.\n- **Hor√°rio de funcionamento:** Segunda a sexta das **7:30h √†s 18h**; **s√°bado e domingo n√£o abrimos**.\n- **Encomendas:** n√£o trabalhamos com encomendas sem **pagamento antecipado**.\n- **Servi√ßos n√£o realizados:** n√£o fazemos **pintura, funilaria ou envelopamento**.\n- **Execu√ß√£o dos servi√ßos:** manuten√ß√£o preventiva e corretiva realizadas apenas em nossa **oficina pr√≥pria**.\n- **Reserva de pe√ßas:** atendimento no balc√£o por ordem de chegada; **sem reserva**.\n\n### Pr√°ticas internas da empresa\n- **Antes de passar o valor de uma pe√ßa**, pergunte ao cliente se ele **quer apenas a pe√ßa** ou **a pe√ßa instalada**.  \n  - Se quiser **s√≥ a pe√ßa**: passe o **pre√ßo**.  \n  - Se quiser **instalada**: **transfira para um humano**.\n  - Se o cliente j√° tiver informado o modelo da moto, por√©m sem o ano, enfatize que voc√™ precisa do ano para fazer melhor a consulta."
        }
      },
      "id": "9f4a8330-3750-4e30-9f0d-203abfaab64a",
      "name": "ü§ñ Agente Motok√£o Principal",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        576,
        208
      ]
    },
    {
      "parameters": {
        "jsCode": "// Pega os dados da mensagem que disparou ESTA execu√ß√£o do workflow.\n// √â a nossa refer√™ncia para saber qual mensagem estamos processando.\nconst currentMessage = $('üìã Extrair Informa√ß√µes').first().json;\n\n// Pega TODOS os itens que o n√≥ anterior (Buscar Fila) retornou.\n// Estes s√£o os itens da fila para o mesmo n√∫mero de telefone.\nconst queueMessages = $input.all();\n\n// --- IN√çCIO DA VERIFICA√á√ÉO DE ROBUSTEZ ---\n// 1. Verificar se a fila retornou vazia.\n// Se isso acontecer, algo est√° errado na query do n√≥ \"Buscar Fila\".\nif (queueMessages.length === 0) {\n  // N√£o h√° nada na fila, ent√£o n√£o h√° o que processar. Paramos aqui.\n  return [];\n}\n// --- FIM DA VERIFICA√á√ÉO DE ROBUSTEZ ---\n\n// Pega a √öLTIMA mensagem da lista retornada pela fila.\n// Como a query est√° ordenada por 'timestamp', esta √© a mais recente.\nconst lastMessageInQueue = queueMessages[queueMessages.length - 1].json;\n\n// Pega o ID da mensagem original e o ID da √∫ltima mensagem na fila.\n// Usamos .toString() para garantir que n√£o haver√° erro de tipo (ex: 123 vs \"123\").\nconst currentMessageId = currentMessage.id_mensagem.toString();\nconst lastMessageId = lastMessageInQueue.id_mensagem.toString();\n\n// Compara os IDs.\n// Se o ID da nossa mensagem for o mesmo da √∫ltima na fila, n√≥s continuamos.\nif (currentMessageId === lastMessageId) {\n  // √â a √∫ltima mensagem! Retorna todos os itens da fila para o pr√≥ximo n√≥.\n  return queueMessages;\n} else {\n  // N√£o √© a √∫ltima mensagem. O fluxo para esta execu√ß√£o deve terminar aqui.\n  // Retornamos um array vazio para n√£o passar dados adiante.\n  return [];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -416,
        48
      ],
      "id": "a8ccff7c-3fd0-4490-b9ca-bbbd593face6",
      "name": "üéØ Verificar Posi√ß√£o na Fila"
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        544,
        608
      ],
      "id": "0f9a708d-c027-4a2f-83dc-3a8e65e12475",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        864,
        608
      ],
      "id": "7b060625-bad3-47dc-a39d-d51239d04a51",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $('üìã Extrair Informa√ß√µes').item.json.audio_url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -800,
        208
      ],
      "id": "7f9418fb-dba2-480c-9367-cfe6d3678358",
      "name": "Download √°udio",
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "pt"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -416,
        208
      ],
      "id": "93c77ed8-0a18-4218-a383-2e2726917bc4",
      "name": "Transcrever audio",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.mensagem }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "1382cd26-d96e-4c55-99dd-2ca305ffe82e"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9a7e16f-b6e4-45d7-846d-92dcb3117593",
                    "leftValue": "={{ $json.mensagem_de_audio }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "√Åudio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "468e131d-592c-4517-ae29-1df16201667d",
                    "leftValue": "=",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagem"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1296,
        192
      ],
      "id": "ea5bfb6c-e54b-403a-8fba-57157c384e14",
      "name": "Tipo de mensagem"
    },
    {
      "parameters": {
        "jsCode": "// Pega a resposta do agente de IA do n√≥ anterior\nconst textoAgente = $('ü§ñ Agente Motok√£o Principal').item.json.output;\n\n// Pega os dados de identifica√ß√£o do primeiro n√≥ do fluxo\nconst infoMensagem = $('üìã Extrair Informa√ß√µes').item.json;\n\n// --- In√≠cio da Formata√ß√£o ---\n// Substitui **palavra** por *palavra*\nlet textoFormatado = textoAgente.replace(/\\*\\*(.*?)\\*\\*/g, '*$1*');\n// Remove o caractere '#'\ntextoFormatado = textoFormatado.replace(/#/g, '');\n// --- Fim da Formata√ß√£o ---\n\n// Retorna um novo objeto com TUDO o que o pr√≥ximo n√≥ precisa\nreturn {\n  content: textoFormatado,\n  id_conta: infoMensagem.id_conta,\n  id_conversa: infoMensagem.id_conversa\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        976,
        208
      ],
      "id": "ac0f28d8-96f7-4502-b8bc-5e76fdcc7223",
      "name": "Formatador de texto"
    },
    {
      "parameters": {
        "jsCode": "// Extrair informa√ß√µes da mensagem\nconst message = $('üîç Filtrar Mensagens').first().json.body;\nconst content = message.content || '';\nconst hasAudio = message.attachments?.[0]?.file_type === 'audio';\nconst audioUrl = message.attachments?.[0]?.data_url;\n\nconst SEU_TELEGRAM_CHAT_ID = \"991616326\";\nconst URL_BASE_CHATWOOT = \"https://chatwoot.motokaovirtual.com.br\";\n\nreturn {\n  id_mensagem: message.id,\n  id_conta: message.account?.id,\n  id_conversa: message.conversation.id,\n  telefone: message.sender?.phone_number,\n  nome_cliente: message.sender?.name || 'Cliente',\n  mensagem: content,\n  mensagem_de_audio: hasAudio,\n  audio_url: audioUrl,\n  timestamp: message.created_at,\n  etiquetas: message.conversation?.labels || [],\n  telegram_chat_id: SEU_TELEGRAM_CHAT_ID,\n  url_chatwoot: URL_BASE_CHATWOOT\n};"
      },
      "id": "9de8b87a-5f89-4f9d-b472-884fcf064a7c",
      "name": "üìã Extrair Informa√ß√µes",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1520,
        208
      ]
    },
    {
      "parameters": {
        "description": "Use esta ferramenta OBIGATORIAMENTE como sua √∫nica op√ß√£o para transferir o atendimento para um agente humano. Chame esta ferramenta SEMPRE que o cliente pedir para falar com uma pessoa, expressar frustra√ß√£o (ex: \"voc√™ n√£o entende\"), reclamar de um produto/servi√ßo, ou se a solicita√ß√£o for complexa demais para as outras ferramentas.",
        "workflowId": {
          "__rl": true,
          "value": "DeE5G6KVYJ2j7F2X",
          "mode": "list",
          "cachedResultName": "Transferir para um humano (Motok√£o)"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "telefone": "={{ $('üìã Extrair Informa√ß√µes').item.json.telefone }}",
            "nome": "={{ $('üìã Extrair Informa√ß√µes').item.json.nome_cliente }}",
            "ultima_mensagem": "={{ $('üìù Preparar Mensagem').item.json.mensagem_final }}",
            "id_conta": "={{ $('üìã Extrair Informa√ß√µes').item.json.id_conta }}",
            "id_conversa": "={{ $('üìã Extrair Informa√ß√µes').item.json.id_conversa }}",
            "telegram_chat_id": "={{ $('üìã Extrair Informa√ß√µes').item.json.telegram_chat_id }}\n",
            "url_chatwoot": "={{ $('üìã Extrair Informa√ß√µes').item.json.url_chatwoot }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "nome",
              "displayName": "nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "ultima_mensagem",
              "displayName": "ultima_mensagem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id_conta",
              "displayName": "id_conta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id_conversa",
              "displayName": "id_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_chat_id",
              "displayName": "telegram_chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "url_chatwoot",
              "displayName": "url_chatwoot",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1376,
        448
      ],
      "id": "10983d5a-b1a3-45a4-b633-742c48919506",
      "name": "Escalar humano"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "faq",
        "toolDescription": "=Use esta ferramenta para responder perguntas gerais sobre a empresa, como hor√°rio de funcionamento, localiza√ß√£o, formas de pagamento, garantia e servi√ßos oferecidos. N√ÉO use para buscar produtos ou pe√ßas.",
        "tableName": {
          "__rl": true,
          "value": "faq",
          "mode": "list",
          "cachedResultName": "faq"
        },
        "topK": 8,
        "includeDocumentMetadata": false,
        "options": {
          "queryName": "match_faq"
        }
      },
      "id": "a87906bd-89f4-42e1-8b2a-12d87c6a89f3",
      "name": "faq",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        864,
        448
      ],
      "credentials": {
        "supabaseApi": {
          "id": "F77ClZTv5EStruN4",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "produtos",
        "toolDescription": "=Use esta ferramenta para consultar informa√ß√µes sobre produtos, pe√ßas, SKUs, pre√ßos e estoque da Motok√£o. SEMPRE use esta ferramenta quando a pergunta do cliente for sobre a disponibilidade, compatibilidade ou pre√ßo de um item. N√ÉO use para perguntas gerais sobre a empresa.",
        "tableName": {
          "__rl": true,
          "value": "produtos",
          "mode": "list",
          "cachedResultName": "produtos"
        },
        "topK": 8,
        "includeDocumentMetadata": false,
        "options": {
          "queryName": "match_produtos"
        }
      },
      "id": "f13f834c-f4fb-4179-9ebf-e852f776ec1a",
      "name": "produtos",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        544,
        448
      ],
      "credentials": {
        "supabaseApi": {
          "id": "F77ClZTv5EStruN4",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        272,
        448
      ],
      "id": "437e9509-a565-4ed5-9cc2-ee3edf69b9ed",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ff2cc635-0071-41de-ab27-fbcf7d026386",
              "leftValue": "={{ $json.body.conversation.meta.assignee?.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "empty",
                "singleValue": true
              }
            },
            {
              "id": "daf23cb1-5afe-4115-a7f7-bc02d2d02c65",
              "leftValue": "={{ $json.body.conversation.meta.assignee?.id }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2688,
        240
      ],
      "id": "fe8eeae5-c798-45a7-88a0-fba18c777b49",
      "name": "ü§ñ J√° tem agente?"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot.motokaovirtual.com.br/api/v1/accounts/{{ $json.body.account.id }}/conversations/{{ $json.body.conversation.id }}/assignments",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"assignee_id\": 3\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2448,
        224
      ],
      "id": "10ba30ae-1210-4ad8-a36e-618e877b32e7",
      "name": "‚ûï Atribuir √† IA",
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "model": "deepseek/deepseek-r1-0528",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        112,
        448
      ],
      "id": "802f4f4c-c5a7-4c7b-a3d0-c6b20be5e9ee",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "iI0Ch2Otn0ylKFNx",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -2688,
        400
      ],
      "id": "5aa370b5-0ad9-4d13-8290-ad40abdca36e",
      "name": "Sem Pr√≥ximo Passo 1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1744,
        384
      ],
      "id": "2bdef139-ec98-4427-b80a-92184b8eeeb7",
      "name": "Sem Pr√≥ximo Passo  2"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  const b = item.binary?.data;\n  if (!b) throw new Error('Sem bin√°rio em \"data\"');\n  // For√ßa metadados reconhec√≠veis pela OpenAI\n  b.fileName = b.fileName || 'audio.ogg';\n  b.mimeType = 'audio/ogg';\n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        208
      ],
      "id": "808c220f-1daa-4779-b903-fdc4778bcbe7",
      "name": "Code"
    }
  ],
  "pinData": {},
  "connections": {
    "üîç Filtrar Mensagens": {
      "main": [
        [
          {
            "node": "ü§ñ J√° tem agente?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sem Pr√≥ximo Passo 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ö° Cache Redis Check": {
      "main": [
        [
          {
            "node": "üÜï Nova Mensagem?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üÜï Nova Mensagem?": {
      "main": [
        [
          {
            "node": "‚úÖ Marcar Processado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sem Pr√≥ximo Passo  2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚úÖ Marcar Processado": {
      "main": [
        [
          {
            "node": "üìã Extrair Informa√ß√µes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üì• Enfileirar Mensagem": {
      "main": [
        [
          {
            "node": "‚è≥ Aguardar Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚è≥ Aguardar Fila": {
      "main": [
        [
          {
            "node": "üìã Buscar Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìã Buscar Fila": {
      "main": [
        [
          {
            "node": "üéØ Verificar Posi√ß√£o na Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üóëÔ∏è Limpar Fila": {
      "main": [
        [
          {
            "node": "‚å®Ô∏è Status Digitando",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚å®Ô∏è Status Digitando": {
      "main": [
        [
          {
            "node": "üìù Preparar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìù Preparar Mensagem": {
      "main": [
        [
          {
            "node": "ü§ñ Agente Motok√£o Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üß† Mem√≥ria de Conversa": {
      "ai_memory": [
        [
          {
            "node": "ü§ñ Agente Motok√£o Principal",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "ü§î Ferramenta de Racioc√≠nio": {
      "ai_tool": [
        [
          {
            "node": "ü§ñ Agente Motok√£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "üì§ Enviar Mensagem": {
      "main": [
        [
          {
            "node": "‚úÖ Resposta Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üéØ Webhook Chatwoot": {
      "main": [
        [
          {
            "node": "üîç Filtrar Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ü§ñ Agente Motok√£o Principal": {
      "main": [
        [
          {
            "node": "Formatador de texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üéØ Verificar Posi√ß√£o na Fila": {
      "main": [
        [
          {
            "node": "üóëÔ∏è Limpar Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "produtos",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "faq",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Download √°udio": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcrever audio": {
      "main": [
        [
          {
            "node": "üìù Preparar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tipo de mensagem": {
      "main": [
        [
          {
            "node": "üì• Enfileirar Mensagem",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Download √°udio",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Formatador de texto": {
      "main": [
        [
          {
            "node": "üì§ Enviar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "üìã Extrair Informa√ß√µes": {
      "main": [
        [
          {
            "node": "Tipo de mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Escalar humano": {
      "ai_tool": [
        [
          {
            "node": "ü§ñ Agente Motok√£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "faq": {
      "ai_tool": [
        [
          {
            "node": "ü§ñ Agente Motok√£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "produtos": {
      "ai_tool": [
        [
          {
            "node": "ü§ñ Agente Motok√£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "ü§ñ Agente Motok√£o Principal",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ü§ñ J√° tem agente?": {
      "main": [
        [
          {
            "node": "‚ûï Atribuir √† IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "‚ûï Atribuir √† IA": {
      "main": [
        [
          {
            "node": "‚ö° Cache Redis Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Sem Pr√≥ximo Passo 1": {
      "main": [
        []
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Transcrever audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "75138b2f-a33b-426d-8b9c-b7435fb06c7b",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "cc8408cceae7fa0f8b71136a7f42ebc73548c779275a4018abe7f6d69be1e4cd"
  },
  "id": "VVSZiUFHTGpppso9",
  "tags": []
}
