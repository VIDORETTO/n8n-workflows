{
  "name": "1. Atendente MotokÃ£o [v2]",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.body.message_type }}",
              "rightValue": "incoming",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "149f8496-42a2-44d8-85ce-27f4f8dd76d7"
            },
            {
              "leftValue": "={{ $json.body.conversation?.labels }}",
              "rightValue": "agente-off",
              "operator": {
                "type": "array",
                "operation": "notContains",
                "rightType": "any"
              },
              "id": "a36d3a6e-779d-46e1-a533-fe4ffe772bce"
            },
            {
              "id": "f215f904-dbfd-49e9-986e-4faf0e981d64",
              "leftValue": "={{ $json.body.conversation?.labels }}",
              "rightValue": "mecanico",
              "operator": {
                "type": "array",
                "operation": "notContains",
                "rightType": "any"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "440b19fa-3bb4-457f-b76f-5c39ba045b2b",
      "name": "ğŸ” Filtrar Mensagens",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -2896,
        256
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $json.body.conversation.id }}_{{ $json.body.id }}",
        "options": {}
      },
      "id": "bf697bc2-8c29-4b16-8619-410a3d5598b3",
      "name": "âš¡ Cache Redis Check",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2208,
        224
      ],
      "credentials": {
        "redis": {
          "id": "LEzG1SL5E566nY65",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "leftValue": "={{ $json.value }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "isEmpty"
              },
              "id": "78adc0f8-c25a-4b59-aa85-67b3492f1874"
            },
            {
              "id": "f0158bac-2764-4160-8332-7e59c3516339",
              "leftValue": "={{ $('âš¡ Cache Redis Check').item.json.value }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "881a2586-53f0-4e3a-a559-6caa77a68fe8",
      "name": "ğŸ†• Nova Mensagem?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -1984,
        224
      ]
    },
    {
      "parameters": {
        "operation": "set",
        "key": "={{ $json.body.conversation.id }}_{{ $json.body.id }}",
        "value": "processed",
        "expire": true,
        "ttl": 3600
      },
      "id": "020a1d7d-87bb-4b30-a917-71358b18fab8",
      "name": "âœ… Marcar Processado",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1760,
        208
      ],
      "credentials": {
        "redis": {
          "id": "LEzG1SL5E566nY65",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "motokao_message_queue",
          "mode": "list"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "id_mensagem",
              "value": "={{ $json.id_mensagem }}"
            },
            {
              "column": "id_conta",
              "value": "={{ $json.id_conta }}"
            },
            {
              "column": "id_conversa",
              "value": "={{ $json.id_conversa }}"
            },
            {
              "column": "telefone",
              "value": "={{ $json.telefone }}"
            },
            {
              "column": "nome_cliente",
              "value": "={{ $json.nome_cliente }}"
            },
            {
              "column": "mensagem",
              "value": "={{ $json.mensagem }}"
            },
            {
              "column": "mensagem_de_audio",
              "value": "={{ $json.mensagem_de_audio }}"
            },
            {
              "column": "audio_url",
              "value": "={{ $json.audio_url || null }}"
            },
            {
              "column": "timestamp",
              "value": "={{ $json.timestamp }}"
            },
            {
              "column": "etiquetas",
              "value": "={{ $json.etiquetas }}"
            }
          ]
        },
        "options": {}
      },
      "id": "b3747e7f-a21a-466d-9a29-315a1b5048ed",
      "name": "ğŸ“¥ Enfileirar Mensagem",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        -992,
        48
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase MotokÃ£o"
        }
      }
    },
    {
      "parameters": {
        "amount": 10,
        "unit": "seconds"
      },
      "id": "f237dfb2-28b5-4182-b1da-203f02f6ecf9",
      "name": "â³ Aguardar Fila",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        -800,
        48
      ],
      "webhookId": "74568c9b-5102-48de-b494-be330a24a069"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "motokao_message_queue",
          "mode": "list"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "telefone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "sort": {
          "values": [
            {
              "column": "timestamp"
            }
          ]
        },
        "options": {}
      },
      "id": "6ac10f71-7cab-44ea-b33b-e8c13b606c71",
      "name": "ğŸ“‹ Buscar Fila",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        -608,
        48
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase MotokÃ£o"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "motokao_message_queue",
          "mode": "list"
        },
        "deleteCommand": "delete",
        "where": {
          "values": [
            {
              "column": "telefone",
              "value": "={{ $json.telefone }}"
            }
          ]
        },
        "options": {}
      },
      "id": "48ae88da-666e-476b-8221-df6043f97180",
      "name": "ğŸ—‘ï¸ Limpar Fila",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2,
      "position": [
        -224,
        48
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase MotokÃ£o"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot.motokaovirtual.com.br/api/v1/accounts/{{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.id_conta }}/conversations/{{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.id_conversa }}/toggle_typing_status",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "typing_status",
              "value": "on"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "text"
            }
          }
        }
      },
      "id": "2de7f08f-447f-4550-be5a-6ec1615f0311",
      "name": "âŒ¨ï¸ Status Digitando",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        96,
        208
      ],
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "mensagem_final",
              "stringValue": "={{ \n(() => {\n  const t = (v) => (v ?? '').toString().trim();\n\n  // Sempre existe\n  const info = $('ğŸ“‹ Extrair InformaÃ§Ãµes').first().json || {};\n  const isAudio = !!info.mensagem_de_audio; // vem do Extrair Info\n\n  // Se NÃƒO for Ã¡udio, tenta pegar sÃ³ a ÃšLTIMA mensagem da fila\n  if (!isAudio) {\n    try {\n      const fila = $('ğŸ¯ Verificar PosiÃ§Ã£o na Fila').all();\n      if (fila.length) {\n        const ult = fila[fila.length - 1];\n        const msg = t(ult.json?.mensagem);\n        if (msg) return msg;\n      }\n    } catch (e) { /* nÃ³ nÃ£o executou? tudo bem */ }\n  }\n\n  // Se for Ã¡udio (ou texto da fila nÃ£o veio), tenta a transcriÃ§Ã£o\n  try {\n    const tx = $('Transcrever audio').first(); // nome exato do nÃ³\n    const txText = t(tx?.json?.text);\n    if (txText) return txText;\n  } catch (e) { /* nÃ³ nÃ£o executou? segue o baile */ }\n\n  // Fallback: conteÃºdo bruto\n  return t(info.mensagem);\n})()\n}}\n"
            },
            {}
          ]
        },
        "options": {}
      },
      "id": "d525663d-8162-40f9-9891-2b8d80035eef",
      "name": "ğŸ“ Preparar Mensagem",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3,
      "position": [
        320,
        208
      ]
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.telefone }}",
        "tableName": "motokao_chat_memory"
      },
      "id": "4b8df94a-26ae-4cc3-9908-9022db1c5091",
      "name": "ğŸ§  MemÃ³ria de Conversa",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1,
      "position": [
        432,
        448
      ],
      "credentials": {
        "postgres": {
          "id": "SeOzgESQk3VyCV02",
          "name": "Supabase MotokÃ£o"
        }
      }
    },
    {
      "parameters": {
        "description": "=**Ferramenta de AnÃ¡lise e EstratÃ©gia TÃ©cnica.** Use esta ferramenta como seu passo ZERO para qualquer solicitaÃ§Ã£o que nÃ£o seja trivial. Sua funÃ§Ã£o Ã© modelar seu raciocÃ­nio de especialista.\n\n**CENÃRIOS DE USO OBRIGATÃ“RIO:**\n- **Consultas Multi-Produto:** Cliente pede mais de um item.\n- **AnÃ¡lise de Compatibilidade Cruzada:** PeÃ§a vs. Moto, PeÃ§a vs. PeÃ§a.\n- **DeduÃ§Ã£o de IntenÃ§Ã£o:** Quando o pedido Ã© um uso (ex: \"pneu pra fazer trilha\") e nÃ£o um produto especÃ­fico.\n- **Planejamento de Busca:** Antes de qualquer busca, para definir os termos exatos a serem usados.\n\n**PROTOCOLO DE SAÃDA OBRIGATÃ“RIO:**\nSua saÃ­da DEVE seguir estritamente o seguinte formato de Markdown:\n\n**AnÃ¡lise:** [Aqui vocÃª descreve sua interpretaÃ§Ã£o da necessidade real e completa do cliente.]\n**Plano de AÃ§Ã£o:**\n1.  **Passo 1:** [Descreva a primeira aÃ§Ã£o que vocÃª vai tomar, ex: 'Usar a ferramenta X para buscar Y'.]\n2.  **Passo 2:** [Descreva a segunda aÃ§Ã£o, se houver.]\n3.  **...**\n**ValidaÃ§Ã£o:** [Descreva o que vocÃª precisa confirmar ou a hipÃ³tese que estÃ¡ testando com seu plano.]\n\n**Exemplo:**\n**AnÃ¡lise:** O cliente precisa do kit completo de transmissÃ£o (coroa, corrente, pinhÃ£o) para a moto Honda Bros 160, ano 2020.\n**Plano de AÃ§Ã£o:**\n1.  **Passo 1:** Usar `buscar_produtos_motokao` com o termo \"coroa Bros 160 2020\".\n2.  **Passo 2:** Usar `buscar_produtos_motokao` com o termo \"corrente Bros 160 2020\".\n3.  **Passo 3:** Usar `buscar_produtos_motokao` com o termo \"pinhÃ£o Bros 160 2020\".\n4.  **Passo 4:** Consolidar os resultados e apresentar ao cliente.\n**ValidaÃ§Ã£o:** Preciso confirmar a disponibilidade e o preÃ§o de cada um dos trÃªs componentes para o modelo e ano exatos."
      },
      "id": "a3cc2579-4a69-4923-bffe-0edb51dfda02",
      "name": "ğŸ¤” Ferramenta de RaciocÃ­nio",
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        1200,
        448
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot.motokaovirtual.com.br/api/v1/accounts/{{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.id_conta }}/conversations/{{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.id_conversa }}/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "content",
              "value": "={{ $json.content }}"
            },
            {
              "name": "message_type",
              "value": "outgoing"
            }
          ]
        },
        "options": {}
      },
      "id": "cf975af3-e42f-48f3-9d64-4e2c43920d8b",
      "name": "ğŸ“¤ Enviar Mensagem",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        1200,
        208
      ],
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "text",
        "responseBody": "âœ… Mensagem MotokÃ£o processada com sucesso!",
        "options": {}
      },
      "id": "75bdd241-54bf-4bbd-8192-a4c27bce9c4c",
      "name": "âœ… Resposta Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1440,
        208
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "003c4b22-55e7-4897-a3e0-c8e1a3ad5540",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3136,
        256
      ],
      "id": "7e097cdb-556e-42a5-85a6-b1b8b0da9201",
      "name": "ğŸ¯ Webhook Chatwoot",
      "webhookId": "003c4b22-55e7-4897-a3e0-c8e1a3ad5540"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.mensagem_final }}",
        "options": {
          "systemMessage": "=HOJE Ã‰: {{ $now.format('FFFF') }}\n\n# AGENTE DE ATENDIMENTO **MotokÃ£o**\n**FunÃ§Ã£o:** Assistente virtual para atendimento e suporte tÃ©cnico  \n**Objetivo PrimÃ¡rio:**\n- Responder perguntas sobre produtos e serviÃ§os. Apenas assuntos relacionados Ã  empresa.\n- Consultar bancos de dados em tempo real.\n- Escalar casos complexos para humanos.\n**Tom:** AmigÃ¡vel, profissional, empÃ¡tico e direto, sem enrolaÃ§Ãµes. Evitar jargÃµes tÃ©cnicos nas explicaÃ§Ãµes; manter tÃ­tulos tÃ©cnicos conforme o catÃ¡logo.\n\n## ğŸ CONTEXTO OPERACIONAL\n- **EspecializaÃ§Ã£o / Escopo:**\n  - ManutenÃ§Ã£o **preventiva** (antes da falha) e **corretiva** (pÃ³s-falha).\n  - **EspecializaÃ§Ã£o:** atendemos motos **100â€“400cc**, qualquer moto fora dessa faixa precisamos consultar com o mecanico.   \n  - **HorÃ¡rio de funcionamento:** Segunda a sexta das **7:30h Ã s 18h**; **sÃ¡bado e domingo nÃ£o abrimos**.\n\n- **Limites de AtuaÃ§Ã£o:**  \n  - âŒ NÃ£o dar instruÃ§Ãµes mecÃ¢nicas (o assistente entende o tema, mas nÃ£o fornece passo a passo tÃ©cnico).  \n  - âŒ NÃ£o diagnosticar problemas sem dados suficientes â€” peÃ§a para trazer a moto para analisarmos melhor.  \n  - âŒ NÃ£o Ã© necessÃ¡rio revelar o nosso SKU para o cliente.  \n  - âŒ NÃ£o Ã© necessÃ¡rio informar a quantidade de estoque disponÃ­vel.  \n  - âŒ NÃ£o insira muitos assuntos na conversa; foque apenas no que o cliente precisa, um de cada vez.  \n  - âŒ NÃ£o dÃª valores de mÃ£o de obra; diga que vai verificar com o responsÃ¡vel e transfira para um humano.\n\n### ğŸš¦ Fluxo de Atendimento â€” Chain of Thought\n\n1) SaudaÃ§Ã£o\n- \"OlÃ¡! Sou o assistente do MotokÃ£o ğŸ‘‹ Como posso te ajudar?\"\n\n2) Quando o cliente pedir preÃ§o\n- Pergunte: \"VocÃª precisa sÃ³ da peÃ§a ou jÃ¡ com instalaÃ§Ã£o?\"\n- Capture dados essenciais (se ainda nÃ£o tiver): \"Qual o modelo da moto e o ano?\"\n- Reforce com sutileza: \"A instalaÃ§Ã£o aqui no MotokÃ£o garante qualidade e garantia do serviÃ§o e da peÃ§a.\"\n\n3) Se for **sÃ³ a peÃ§a**\n- [Consultar banco de dados \"produtos\" e confirmar modelo/ano exatos]\n- Se encontrado: \"Encontrei **[PEÃ‡A]** para **[MOTO/ANO]** por **R$ [PREÃ‡O]**.\"\n- Complementos Ãºteis:\n  - (Se houver variaÃ§Ãµes): \"Temos essas opÃ§Ãµes: [VARIAÃ‡Ã•ES QUE FIZEREM SENTIDO, NÃƒO FALE DE PEÃ‡AS ALEATÃ“RIAS].\"\n\n4) Se for **peÃ§a + instalaÃ§Ã£o**\n- \"Para te passar o valor instalado preciso confirmar a mÃ£o de obra com a oficina. Vou te transferir agora para um atendente.\" [Transferir para humano]\n\n5) Encerramento\n- \"Posso te ajudar em mais alguma coisa?\"\n\n#### Regras rÃ¡pidas (evita erro)\n- NÃ£o invente preÃ§o/estoque. Se houver dÃºvida, peÃ§a confirmaÃ§Ã£o do modelo/ano e cÃ³digo/SKU.\n- Sempre que possÃ­vel, envie o link do anÃºncio (Mercado Livre) ou cÃ³digo interno para o cliente conferir.\n- Se o cliente estiver indeciso, ofereÃ§a reservar por tempo limitado (conforme polÃ­tica da loja) ou avisar quando repor.\n\n\n### PolÃ­ticas de Escalonamento  \n- ReclamaÃ§Ã£o de serviÃ§o feito por nÃ³s.  \n- Falha na consulta (tente novamente e escale na 2Âª falha).  \n- Pedido de orÃ§amento complexo, com muitas peÃ§as ou envolvendo mÃ£o de obra.\n\n## âš™ï¸ FERRAMENTAS OPERACIONAIS\n### 1. `faq` (Banco de Dados Supabase)\n- **Uso:** Consultar para perguntas gerais.\n\n### 2. `produtos` (Banco de Dados Supabase)\n- **Uso:** Acione ao detectar interesse em **saber mais sobre uma peÃ§a** (detalhes, compatibilidade, preÃ§o).\n\n## MODO DE USAR AS FERRAMENTAS\n### 1. `faq`  \nUse para perguntas gerais. Sempre que algo nÃ£o estiver no system prompt ou no histÃ³rico da conversa, use essa ferramenta para confirmar detalhes sobre a dÃºvida do cliente; caso nÃ£o encontre, **faÃ§a a transferÃªncia para um humano**.\n\n### 2. `produtos` â€” Fluxo de uso da ferramenta\n1. **Entender o pedido do cliente**  \n   - Identifique a peÃ§a solicitada.  \n   - Liste possÃ­veis **sinÃ´nimos, abreviaÃ§Ãµes e descriÃ§Ãµes equivalentes**.\n2. **Analisar a motocicleta**  \n   - Confirme **modelo** e **ano** exatos informados pelo cliente.  \n   - Caso o ano nÃ£o seja informado, **pergunte antes de prosseguir**.\n3. **Pesquisar no catÃ¡logo**  \n   - Utilize **sinÃ´nimos + modelo + ano** como filtros.  \n   - Priorize correspondÃªncias **exatas de ano**; se nÃ£o houver, verifique **anos adjacentes** (ex.: 2022/2024 quando o cliente busca 2023).\n4. **Quando nÃ£o houver o ano exato**  \n   > â€œEncontrei a peÃ§a **X** para sua moto. Mas preciso confirmar com o mecÃ¢nico se ela serve no **[ANO]** da sua moto.â€\n5. **PadrÃ£o de tÃ­tulo de produto**  \n   **NOME DA PEÃ‡A [Ã s vezes com abreviaÃ§Ã£o] + MOTO DE APLICAÃ‡ÃƒO (ANO) + OUTRAS MOTOS COMPATÃVEIS + MARCA [Ã s vezes indisponÃ­vel]**  \n   **Exemplo:** `KIT RELAÃ‡ÃƒO CG160 16...22/BROS160 18...22 DID`  \n   *Lembrete:* a peÃ§a necessÃ¡ria pode estar listada como compatÃ­vel com outros modelos (ex.: pedido para Bros 160 pode aparecer na descriÃ§Ã£o da CG 160).\n\n## PolÃ­ticas da empresa\n- **Entregas:** NÃ£o fazemos **entregas pela loja fÃ­sica dentro da cidade**. **Se o cliente morar em outra cidade podemos fazer o envio atravÃ©s de transportadora ou Mercado Livre**.  \n- **Atendimento:** NÃ£o fazemos agendamento; trabalhamos por **ordem de chegada**.  \n- **InstalaÃ§Ã£o de peÃ§as:** NÃ£o instalamos peÃ§as que **nÃ£o** foram compradas com a gente.\n- **Escopo de serviÃ§os:** NÃ£o realizamos serviÃ§os em motos de alta cilindrada (**acima de 400cc**) nem em motos importadas de difÃ­cil acesso a peÃ§as.\n- **Pagamentos (balcÃ£o presencial):**\n  - Parcelamos compras no **cartÃ£o em atÃ© 3x sem juros** (balcÃ£o).\n  - **Desconto:** 5% no **dinheiro** Ã  vista ou 3% no **Pix** (somente para pagamentos no balcÃ£o).\n\n### PolÃ­tica de PeÃ§as\n**PosiÃ§Ã£o oficial:** Trabalhamos **exclusivamente com peÃ§as paralelas  de alta qualidade**. SÃ£o opÃ§Ãµes de **custo consideravelmente menor** e **qualidade muito semelhante** Ã s originais. Selecionamos **marcas confiÃ¡veis** para evitar dor de cabeÃ§a para o cliente e empresa.\n\n**O que o agente deve fazer**\n- âœ… Dizer que sÃ³ oferecemos **paralelas de alta qualidade**.\n- âœ… Destacar **bom custo-benefÃ­cio** e **qualidade equivalente**.\n- âœ… ReforÃ§ar que **somos criteriosos na escolha das marcas**.\n\n**O que o agente nÃ£o deve fazer**\n- âŒ **NÃ£o** oferecer peÃ§as originais nem sugerir que conseguimos sob demanda.\n- âŒ **NÃ£o** prometer que a peÃ§a Ã© â€œidÃªntica Ã  originalâ€; prefira â€œqualidade **muito semelhante**/equivalenteâ€.\n- âŒ **NÃ£o** citar marcas especÃ­ficas se nÃ£o estiverem no contexto/dados.\n\n**Frases modelo (use e adapte)**\n- â€œTrabalhamos **somente com peÃ§as paralelas de alta qualidade**, com **custo bem mais baixo** e **qualidade muito semelhante** Ã  original.â€\n- â€œSelecionamos **apenas marcas confiÃ¡veis** para garantir durabilidade e evitar problemas futuros para o cliente e empresa.â€\n- â€œNÃ£o oferecemos peÃ§a original; nossa **linha Ã© paralela premium**, com **excelente custo-benefÃ­cio**.â€\n\n**Se o cliente pedir peÃ§a original**\n- Responder: â€œNo momento trabalhamos **exclusivamente com peÃ§as paralelas de alta qualidade**. Posso verificar a opÃ§Ã£o equivalente para o seu modelo?â€\n\n- **Garantia:** segue a legislaÃ§Ã£o vigente e cobre apenas **defeitos de fabricaÃ§Ã£o**, nÃ£o por mal uso.\n- **PolÃ­tica de vendas e trocas:**\n  - NÃ£o vendemos **peÃ§as usadas**.\n  - NÃ£o realizamos **devoluÃ§Ã£o de peÃ§as** apÃ³s instalaÃ§Ã£o.\n  - **Troca** de produtos deve ser transferido para um humano.\n- **HorÃ¡rio de funcionamento:** Segunda a sexta das **7:30h Ã s 18h**; **sÃ¡bado e domingo nÃ£o abrimos**.\n- **Encomendas:** nÃ£o trabalhamos com encomendas sem **pagamento antecipado**.\n- **ServiÃ§os nÃ£o realizados:** nÃ£o fazemos **pintura, funilaria ou envelopamento**.\n- **ExecuÃ§Ã£o dos serviÃ§os:** manutenÃ§Ã£o preventiva e corretiva realizadas apenas em nossa **oficina prÃ³pria**.\n- **Reserva de peÃ§as:** atendimento no balcÃ£o por ordem de chegada; **sem reserva**.\n\n### PrÃ¡ticas internas da empresa\n- **Antes de passar o valor de uma peÃ§a**, pergunte ao cliente se ele **quer apenas a peÃ§a** ou **a peÃ§a instalada**.  \n  - Se quiser **sÃ³ a peÃ§a**: passe o **preÃ§o**.  \n  - Se quiser **instalada**: **transfira para um humano**.\n  - Se o cliente jÃ¡ tiver informado o modelo da moto, porÃ©m sem o ano, enfatize que vocÃª precisa do ano para fazer melhor a consulta."
        }
      },
      "id": "9f4a8330-3750-4e30-9f0d-203abfaab64a",
      "name": "ğŸ¤– Agente MotokÃ£o Principal",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        576,
        208
      ]
    },
    {
      "parameters": {
        "jsCode": "// Pega os dados da mensagem que disparou ESTA execuÃ§Ã£o do workflow.\n// Ã‰ a nossa referÃªncia para saber qual mensagem estamos processando.\nconst currentMessage = $('ğŸ“‹ Extrair InformaÃ§Ãµes').first().json;\n\n// Pega TODOS os itens que o nÃ³ anterior (Buscar Fila) retornou.\n// Estes sÃ£o os itens da fila para o mesmo nÃºmero de telefone.\nconst queueMessages = $input.all();\n\n// --- INÃCIO DA VERIFICAÃ‡ÃƒO DE ROBUSTEZ ---\n// 1. Verificar se a fila retornou vazia.\n// Se isso acontecer, algo estÃ¡ errado na query do nÃ³ \"Buscar Fila\".\nif (queueMessages.length === 0) {\n  // NÃ£o hÃ¡ nada na fila, entÃ£o nÃ£o hÃ¡ o que processar. Paramos aqui.\n  return [];\n}\n// --- FIM DA VERIFICAÃ‡ÃƒO DE ROBUSTEZ ---\n\n// Pega a ÃšLTIMA mensagem da lista retornada pela fila.\n// Como a query estÃ¡ ordenada por 'timestamp', esta Ã© a mais recente.\nconst lastMessageInQueue = queueMessages[queueMessages.length - 1].json;\n\n// Pega o ID da mensagem original e o ID da Ãºltima mensagem na fila.\n// Usamos .toString() para garantir que nÃ£o haverÃ¡ erro de tipo (ex: 123 vs \"123\").\nconst currentMessageId = currentMessage.id_mensagem.toString();\nconst lastMessageId = lastMessageInQueue.id_mensagem.toString();\n\n// Compara os IDs.\n// Se o ID da nossa mensagem for o mesmo da Ãºltima na fila, nÃ³s continuamos.\nif (currentMessageId === lastMessageId) {\n  // Ã‰ a Ãºltima mensagem! Retorna todos os itens da fila para o prÃ³ximo nÃ³.\n  return queueMessages;\n} else {\n  // NÃ£o Ã© a Ãºltima mensagem. O fluxo para esta execuÃ§Ã£o deve terminar aqui.\n  // Retornamos um array vazio para nÃ£o passar dados adiante.\n  return [];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -416,
        48
      ],
      "id": "a8ccff7c-3fd0-4490-b9ca-bbbd593face6",
      "name": "ğŸ¯ Verificar PosiÃ§Ã£o na Fila"
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        544,
        608
      ],
      "id": "0f9a708d-c027-4a2f-83dc-3a8e65e12475",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-ada-002",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        864,
        608
      ],
      "id": "7b060625-bad3-47dc-a39d-d51239d04a51",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.audio_url }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -800,
        208
      ],
      "id": "7f9418fb-dba2-480c-9367-cfe6d3678358",
      "name": "Download Ã¡udio",
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {
          "language": "pt"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        -416,
        208
      ],
      "id": "93c77ed8-0a18-4218-a383-2e2726917bc4",
      "name": "Transcrever audio",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.mensagem }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    },
                    "id": "1382cd26-d96e-4c55-99dd-2ca305ffe82e"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9a7e16f-b6e4-45d7-846d-92dcb3117593",
                    "leftValue": "={{ $json.mensagem_de_audio }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Ãudio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "468e131d-592c-4517-ae29-1df16201667d",
                    "leftValue": "=",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Imagem"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1296,
        192
      ],
      "id": "ea5bfb6c-e54b-403a-8fba-57157c384e14",
      "name": "Tipo de mensagem"
    },
    {
      "parameters": {
        "jsCode": "// Pega a resposta do agente de IA do nÃ³ anterior\nconst textoAgente = $('ğŸ¤– Agente MotokÃ£o Principal').item.json.output;\n\n// Pega os dados de identificaÃ§Ã£o do primeiro nÃ³ do fluxo\nconst infoMensagem = $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json;\n\n// --- InÃ­cio da FormataÃ§Ã£o ---\n// Substitui **palavra** por *palavra*\nlet textoFormatado = textoAgente.replace(/\\*\\*(.*?)\\*\\*/g, '*$1*');\n// Remove o caractere '#'\ntextoFormatado = textoFormatado.replace(/#/g, '');\n// --- Fim da FormataÃ§Ã£o ---\n\n// Retorna um novo objeto com TUDO o que o prÃ³ximo nÃ³ precisa\nreturn {\n  content: textoFormatado,\n  id_conta: infoMensagem.id_conta,\n  id_conversa: infoMensagem.id_conversa\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        976,
        208
      ],
      "id": "ac0f28d8-96f7-4502-b8bc-5e76fdcc7223",
      "name": "Formatador de texto"
    },
    {
      "parameters": {
        "jsCode": "// Extrair informaÃ§Ãµes da mensagem\nconst message = $('ğŸ” Filtrar Mensagens').first().json.body;\nconst content = message.content || '';\nconst hasAudio = message.attachments?.[0]?.file_type === 'audio';\nconst audioUrl = message.attachments?.[0]?.data_url;\n\nconst SEU_TELEGRAM_CHAT_ID = \"991616326\";\nconst URL_BASE_CHATWOOT = \"https://chatwoot.motokaovirtual.com.br\";\n\nreturn {\n  id_mensagem: message.id,\n  id_conta: message.account?.id,\n  id_conversa: message.conversation.id,\n  telefone: message.sender?.phone_number,\n  nome_cliente: message.sender?.name || 'Cliente',\n  mensagem: content,\n  mensagem_de_audio: hasAudio,\n  audio_url: audioUrl,\n  timestamp: message.created_at,\n  etiquetas: message.conversation?.labels || [],\n  telegram_chat_id: SEU_TELEGRAM_CHAT_ID,\n  url_chatwoot: URL_BASE_CHATWOOT\n};"
      },
      "id": "9de8b87a-5f89-4f9d-b472-884fcf064a7c",
      "name": "ğŸ“‹ Extrair InformaÃ§Ãµes",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1520,
        208
      ]
    },
    {
      "parameters": {
        "description": "Use esta ferramenta OBIGATORIAMENTE como sua Ãºnica opÃ§Ã£o para transferir o atendimento para um agente humano. Chame esta ferramenta SEMPRE que o cliente pedir para falar com uma pessoa, expressar frustraÃ§Ã£o (ex: \"vocÃª nÃ£o entende\"), reclamar de um produto/serviÃ§o, ou se a solicitaÃ§Ã£o for complexa demais para as outras ferramentas.",
        "workflowId": {
          "__rl": true,
          "value": "DeE5G6KVYJ2j7F2X",
          "mode": "list",
          "cachedResultName": "Transferir para um humano (MotokÃ£o)"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "telefone": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.telefone }}",
            "nome": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.nome_cliente }}",
            "ultima_mensagem": "={{ $('ğŸ“ Preparar Mensagem').item.json.mensagem_final }}",
            "id_conta": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.id_conta }}",
            "id_conversa": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.id_conversa }}",
            "telegram_chat_id": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.telegram_chat_id }}\n",
            "url_chatwoot": "={{ $('ğŸ“‹ Extrair InformaÃ§Ãµes').item.json.url_chatwoot }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "nome",
              "displayName": "nome",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "ultima_mensagem",
              "displayName": "ultima_mensagem",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id_conta",
              "displayName": "id_conta",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "id_conversa",
              "displayName": "id_conversa",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telegram_chat_id",
              "displayName": "telegram_chat_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "url_chatwoot",
              "displayName": "url_chatwoot",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        1376,
        448
      ],
      "id": "10983d5a-b1a3-45a4-b633-742c48919506",
      "name": "Escalar humano"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "faq",
        "toolDescription": "=Use esta ferramenta para responder perguntas gerais sobre a empresa, como horÃ¡rio de funcionamento, localizaÃ§Ã£o, formas de pagamento, garantia e serviÃ§os oferecidos. NÃƒO use para buscar produtos ou peÃ§as.",
        "tableName": {
          "__rl": true,
          "value": "faq",
          "mode": "list",
          "cachedResultName": "faq"
        },
        "topK": 8,
        "includeDocumentMetadata": false,
        "options": {
          "queryName": "match_faq"
        }
      },
      "id": "a87906bd-89f4-42e1-8b2a-12d87c6a89f3",
      "name": "faq",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        864,
        448
      ],
      "credentials": {
        "supabaseApi": {
          "id": "F77ClZTv5EStruN4",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "produtos",
        "toolDescription": "=Use esta ferramenta para consultar informaÃ§Ãµes sobre produtos, peÃ§as, SKUs, preÃ§os e estoque da MotokÃ£o. SEMPRE use esta ferramenta quando a pergunta do cliente for sobre a disponibilidade, compatibilidade ou preÃ§o de um item. NÃƒO use para perguntas gerais sobre a empresa.",
        "tableName": {
          "__rl": true,
          "value": "produtos",
          "mode": "list",
          "cachedResultName": "produtos"
        },
        "topK": 8,
        "includeDocumentMetadata": false,
        "options": {
          "queryName": "match_produtos"
        }
      },
      "id": "f13f834c-f4fb-4179-9ebf-e852f776ec1a",
      "name": "produtos",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        544,
        448
      ],
      "credentials": {
        "supabaseApi": {
          "id": "F77ClZTv5EStruN4",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-5",
          "mode": "list",
          "cachedResultName": "gpt-5"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        272,
        448
      ],
      "id": "437e9509-a565-4ed5-9cc2-ee3edf69b9ed",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "aGijCClKIFF3AhEo",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ff2cc635-0071-41de-ab27-fbcf7d026386",
              "leftValue": "={{ $json.body.conversation.meta.assignee?.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "empty",
                "singleValue": true
              }
            },
            {
              "id": "daf23cb1-5afe-4115-a7f7-bc02d2d02c65",
              "leftValue": "={{ $json.body.conversation.meta.assignee?.id }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2688,
        240
      ],
      "id": "fe8eeae5-c798-45a7-88a0-fba18c777b49",
      "name": "ğŸ¤– JÃ¡ tem agente?"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://chatwoot.motokaovirtual.com.br/api/v1/accounts/{{ $json.body.account.id }}/conversations/{{ $json.body.conversation.id }}/assignments",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "chatwootApi",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "{\n  \"assignee_id\": 3\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -2448,
        224
      ],
      "id": "10ba30ae-1210-4ad8-a36e-618e877b32e7",
      "name": "â• Atribuir Ã  IA",
      "credentials": {
        "chatwootApi": {
          "id": "zmNL6YOUO92XXR5V",
          "name": "ChatWoot account"
        }
      }
    },
    {
      "parameters": {
        "model": "deepseek/deepseek-r1-0528",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        112,
        448
      ],
      "id": "802f4f4c-c5a7-4c7b-a3d0-c6b20be5e9ee",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "iI0Ch2Otn0ylKFNx",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -2688,
        400
      ],
      "id": "5aa370b5-0ad9-4d13-8290-ad40abdca36e",
      "name": "Sem PrÃ³ximo Passo 1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1744,
        384
      ],
      "id": "2bdef139-ec98-4427-b80a-92184b8eeeb7",
      "name": "Sem PrÃ³ximo Passo  2"
    },
    {
      "parameters": {
        "jsCode": "return items.map(item => {\n  const b = item.binary?.data;\n  if (!b) throw new Error('Sem binÃ¡rio em \"data\"');\n  // ForÃ§a metadados reconhecÃ­veis pela OpenAI\n  b.fileName = b.fileName || 'audio.ogg';\n  b.mimeType = 'audio/ogg';\n  return item;\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        208
      ],
      "id": "808c220f-1daa-4779-b903-fdc4778bcbe7",
      "name": "Code"
    }
  ],
  "pinData": {},
  "connections": {
    "ğŸ” Filtrar Mensagens": {
      "main": [
        [
          {
            "node": "ğŸ¤– JÃ¡ tem agente?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sem PrÃ³ximo Passo 1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš¡ Cache Redis Check": {
      "main": [
        [
          {
            "node": "ğŸ†• Nova Mensagem?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ†• Nova Mensagem?": {
      "main": [
        [
          {
            "node": "âœ… Marcar Processado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sem PrÃ³ximo Passo  2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âœ… Marcar Processado": {
      "main": [
        [
          {
            "node": "ğŸ“‹ Extrair InformaÃ§Ãµes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¥ Enfileirar Mensagem": {
      "main": [
        [
          {
            "node": "â³ Aguardar Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â³ Aguardar Fila": {
      "main": [
        [
          {
            "node": "ğŸ“‹ Buscar Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ Buscar Fila": {
      "main": [
        [
          {
            "node": "ğŸ¯ Verificar PosiÃ§Ã£o na Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ—‘ï¸ Limpar Fila": {
      "main": [
        [
          {
            "node": "âŒ¨ï¸ Status Digitando",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âŒ¨ï¸ Status Digitando": {
      "main": [
        [
          {
            "node": "ğŸ“ Preparar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Preparar Mensagem": {
      "main": [
        [
          {
            "node": "ğŸ¤– Agente MotokÃ£o Principal",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ§  MemÃ³ria de Conversa": {
      "ai_memory": [
        [
          {
            "node": "ğŸ¤– Agente MotokÃ£o Principal",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤” Ferramenta de RaciocÃ­nio": {
      "ai_tool": [
        [
          {
            "node": "ğŸ¤– Agente MotokÃ£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¤ Enviar Mensagem": {
      "main": [
        [
          {
            "node": "âœ… Resposta Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ Webhook Chatwoot": {
      "main": [
        [
          {
            "node": "ğŸ” Filtrar Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– Agente MotokÃ£o Principal": {
      "main": [
        [
          {
            "node": "Formatador de texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¯ Verificar PosiÃ§Ã£o na Fila": {
      "main": [
        [
          {
            "node": "ğŸ—‘ï¸ Limpar Fila",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "produtos",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "faq",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Download Ã¡udio": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcrever audio": {
      "main": [
        [
          {
            "node": "ğŸ“ Preparar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tipo de mensagem": {
      "main": [
        [
          {
            "node": "ğŸ“¥ Enfileirar Mensagem",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Download Ã¡udio",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Formatador de texto": {
      "main": [
        [
          {
            "node": "ğŸ“¤ Enviar Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“‹ Extrair InformaÃ§Ãµes": {
      "main": [
        [
          {
            "node": "Tipo de mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Escalar humano": {
      "ai_tool": [
        [
          {
            "node": "ğŸ¤– Agente MotokÃ£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "faq": {
      "ai_tool": [
        [
          {
            "node": "ğŸ¤– Agente MotokÃ£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "produtos": {
      "ai_tool": [
        [
          {
            "node": "ğŸ¤– Agente MotokÃ£o Principal",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "ğŸ¤– Agente MotokÃ£o Principal",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– JÃ¡ tem agente?": {
      "main": [
        [
          {
            "node": "â• Atribuir Ã  IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â• Atribuir Ã  IA": {
      "main": [
        [
          {
            "node": "âš¡ Cache Redis Check",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Sem PrÃ³ximo Passo 1": {
      "main": [
        []
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Transcrever audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "75138b2f-a33b-426d-8b9c-b7435fb06c7b",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "cc8408cceae7fa0f8b71136a7f42ebc73548c779275a4018abe7f6d69be1e4cd"
  },
  "id": "VVSZiUFHTGpppso9",
  "tags": []
}
